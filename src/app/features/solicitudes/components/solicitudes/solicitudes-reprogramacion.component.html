<div class="bg-white border rounded-xl p-4 space-y-4">

  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold">Solicitudes de Reprogramación</h2>
  </div>

  <form [formGroup]="form" class="grid grid-cols-1 md:grid-cols-4 gap-3">
    <div>
      <label class="text-sm text-slate-600">Curso</label>
      <input type="text" formControlName="curso" class="w-full border rounded px-3 py-2" placeholder="Ej. Matemática I"/>
    </div>

    <div>
      <label class="text-sm text-slate-600">Fecha Original</label>
      <input type="date" formControlName="fechaOriginal" class="w-full border rounded px-3 py-2"/>
    </div>

    <div>
      <label class="text-sm text-slate-600">Fecha Nueva</label>
      <input type="date" formControlName="fechaNueva" class="w-full border rounded px-3 py-2"/>
    </div>

    <div class="md:col-span-4">
      <label class="text-sm text-slate-600">Motivo</label>
      <textarea formControlName="motivo" rows="2" class="w-full border rounded px-3 py-2" placeholder="Ej. Coincidencia de horario con reunión académica"></textarea>
    </div>

    <div class="md:col-span-4">
      <button type="button" (click)="crear()" [disabled]="loading()" class="px-4 py-2 rounded bg-indigo-600 text-white disabled:opacity-60">Crear solicitud</button>
      <span *ngIf="loading()" class="text-sm text-slate-500 ml-2">Procesando...</span>
    </div>
  </form>

  <div class="flex flex-col md:flex-row md:items-end gap-3">
    <div>
      <label class="text-sm text-slate-600">Estado</label>
      <select class="border rounded px-3 py-2 w-52"
              [ngModel]="filtroEstado()"
              (ngModelChange)="filtroEstado.set($event || null); aplicarFiltros()">
        <option [ngValue]="null">-- Todos --</option>
        <option value="PENDIENTE">PENDIENTE</option>
        <option value="APROBADA">APROBADA</option>
        <option value="RECHAZADA">RECHAZADA</option>
        <option value="CANCELADA">CANCELADA</option>
      </select>
    </div>

    <div>
      <label class="text-sm text-slate-600">Docente</label>
      <input type="number" class="border rounded px-3 py-2 w-40"
             [ngModel]="filtroDocente()"
             (ngModelChange)="filtroDocente.set($event || null); aplicarFiltros()"/>
    </div>

    <div class="grow"></div>
    <div>
      <button type="button" class="px-3 py-2 border rounded hover:bg-slate-50" (click)="limpiarFiltros()">Limpiar</button>
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full text-sm border-collapse">
      <thead class="bg-slate-100 border-b">
      <tr>
        <th class="p-2 text-left">#</th>
        <th class="p-2 text-left">Curso</th>
        <th class="p-2 text-left">Motivo</th>
        <th class="p-2 text-left">Fecha Original</th>
        <th class="p-2 text-left">Fecha Nueva</th>
        <th class="p-2 text-left">Estado</th>
        <th class="p-2 text-center">Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let r of pagina()?.contenido" class="border-t">
        <td class="p-2">{{ r.idReprogramacion }}</td>
        <td class="p-2">{{ r.curso }}</td>
        <td class="p-2">{{ r.motivo }}</td>
        <td class="p-2">{{ r.fechaOriginal | date:'dd/MM/yyyy' }}</td>
        <td class="p-2">{{ r.fechaNueva | date:'dd/MM/yyyy' }}</td>
        <td class="p-2"><span [ngClass]="chipClass(r.estado)">{{ r.estado }}</span></td>
        <td class="p-2 text-center space-x-2">
          <button class="px-2 py-1 rounded border text-xs hover:bg-slate-50" (click)="aprobar(r)">Aprobar</button>
          <button class="px-2 py-1 rounded border text-xs hover:bg-slate-50" (click)="rechazar(r)">Rechazar</button>
          <button class="px-2 py-1 rounded border text-xs hover:bg-slate-50" (click)="cancelar(r)">Cancelar</button>
        </td>
      </tr>
      <tr *ngIf="pagina()?.vacia">
        <td colspan="7" class="text-center text-slate-500 py-3">Sin resultados</td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="flex items-center justify-between">
    <div class="text-sm text-slate-600">
      Tamaño:
      <select class="border rounded px-2 py-1" [ngModel]="size()" (ngModelChange)="cambiarTamanio(+$event)">
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
      </select>
    </div>

    <div class="flex items-center gap-1">
      <button class="px-2 py-1 border rounded" [disabled]="pagina()?.primera" (click)="irAPagina(0)">«</button>
      <button class="px-2 py-1 border rounded" [disabled]="pagina()?.primera" (click)="irAPagina((pagina()?.paginaActual ?? 0)-1)">‹</button>
      <button *ngFor="let p of rangoPaginas()" class="px-3 py-1 border rounded"
              [ngClass]="{'bg-indigo-600 text-white border-indigo-600': p === pagina()?.paginaActual}"
              (click)="irAPagina(p)">{{ p + 1 }}</button>
      <button class="px-2 py-1 border rounded" [disabled]="pagina()?.ultima" (click)="irAPagina((pagina()?.paginaActual ?? 0)+1)">›</button>
      <button class="px-2 py-1 border rounded" [disabled]="pagina()?.ultima" (click)="irAPagina((pagina()?.totalPaginas ?? 1)-1)">»</button>
    </div>
  </div>

  <div *ngIf="error()" class="text-red-600 text-sm">{{ error() }}</div>
</div>
